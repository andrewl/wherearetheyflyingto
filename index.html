<!DOCTYPE html>
<html>

<head>
  <title>Where are they flying to?</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
  <style>
    #map-canvas {
      width: 100%;
      height: 600px;
    }
  </style>
</head>

<body>
  <div class="heatmap" id="map-canvas"></div>
</body>
<script src="js/heatmap.min.js"></script>
<script src="js/leaflet-heatmap.js"></script>
<script>
  Zepto(function($) {

    var baseLayer = L.tileLayer(
      'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '...',
        maxZoom: 18
      }
    );

    var cfg = {
      // radius should be small ONLY if scaleRadius is true (or small radius is intended)
      // if scaleRadius is false it will be the constant radius used in pixels
      "radius": 2,
      "maxOpacity": .8,
      // scales the radius based on map zoom
      "scaleRadius": true,
      // if set to false the heatmap uses the global maximum for colorization
      // if activated: uses the data maximum within the current map boundaries 
      //   (there will always be a red spot with useLocalExtremas true)
      "useLocalExtrema": true,
      // which field name in your data represents the latitude - default "lat"
      latField: 'lat',
      // which field name in your data represents the longitude - default "lng"
      lngField: 'lng',
      // which field name in your data represents the data value - default "value"
      valueField: 'count'
    };


    var heatmapLayer = new HeatmapOverlay(cfg);

    var map = new L.Map('map-canvas', {
      center: new L.LatLng(30,31),
      zoom: 3,
      layers: [baseLayer, heatmapLayer]
    });

    var destinationData = {};

    $.ajax({
      type: 'GET',
      url: './watft_destinations.json',
      // type of data we are expecting in return:
      dataType: 'json',
      timeout: 300,
      success: function(data) {
        destinationData = {max:0, data:[]};
        $(data).each( function(idx, item) {
          destinationData.data.push({lat: item[1], lng: item[0], count: item[2]});
          if (destinationData.max < item[2]) {
            destinationData.max = item[2];
          }
        });
        console.log(destinationData);
        heatmapLayer.setData(destinationData);
      },
      error: function(xhr, type) {
        alert('Failed to load heatmap data');
      }
    });
  });
</script>

</html>
